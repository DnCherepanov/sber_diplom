# Дипломный проект
Разработка ETL-процесса для выявления мошеннических операций.

Используемые инструменты и библиотеки:
- СУБД Oracle
- Текстовый редактор Visual Studio Code 
- Импортируемые библиотеки: jaydebeapi, os, pandas

### Структура проекта

- main.py - Основной процесс обязательный обработки.
- файлы с данными.
- main.cron - Файл для постановки процесса на расписание, в формате crontab
- archive - Пустой, сюда должны перемещаться отработанные файлы.
- sql_scripts - SQL скрипты, вынесенные в отдельные файлы.

#### Выгрузка данных.

Ежедневно некие информационные системы выгружают следующие файлы:
- Список транзакций за текущий день. Формат – CSV.
- Список терминалов полным срезом. Формат – XLSX.
- Список паспортов, включенных в «черный список» - с накоплением с начала месяца. Формат – XLSX.

#### Структура хранилища.

Данные должны быть загружены в хранилище со следующей структурой:

<img width="769" alt="Screenshot 2023-05-20 at 20 47 30" src="https://github.com/DnCherepanov/sber_diplom/assets/45888415/4ae92425-c6f9-4d8d-a9b8-86d216dd3118">


Ко всем таблицам SCD1 добавлены технические поля create_dt, update_dt; ко всем таблицам SCD2 добавлены технические поля effective_from, effective_to, deleted_flg.

### Построение отчета.

По результатам загрузки ежедневно строится витрина отчетности по мошенническим операциям. Витрина строится накоплением, каждый новый отчет укладывается в эту же таблицу с новым report_dt.

В витрине содержаться следующие поля:
- event_dt - Время наступления события. Если событие наступило по результату нескольких действий – указывается время действия, по которому установлен факт мошенничества.
- passport - Номер паспорта клиента, совершившего мошенническую операцию.
- fio phone - ФИО клиента, совершившего мошенническую операцию. Номер телефона клиента, совершившего мошенническую операцию.
- event_type - ФИО клиента, совершившего мошенническую операцию. Номер телефона клиента, совершившего мошенническую операцию.
- report_dt - Описание типа мошенничества. Время построения отчета.

### Признаки мошеннических операций.

1. Совершение операции при просроченном или заблокированном паспорте. 2. Совершение операции при недействующем договоре.
3. Совершение операций в разных городах в течение одного часа.
4. Попытка подбора суммы. В течение 20 минут проходит более 3х операций со следующим шаблоном – каждая последующая меньше предыдущей, при этом отклонены все кроме последней. Последняя операция (успешная) в такой цепочке считается мошеннической.

### Обработка файлов.

Выгружаемые файлы именуются согласно следующему шаблону:
transactions_DDMMYYYY.txt
passport_blacklist_DDMMYYYY.xlsx
terminals_DDMMYYYY.xlsx
Предполагается что в один день приходит по одному такому файлу. После загрузки соответствующего файла он переименовывается в файл с расширением .backup чтобы при следующем запуске файл не искался и перемещен в каталог archive:
transactions_DDMMYYYY.txt.backup
passport_blacklist_DDMMYYYY.xlsx.backup
terminals_DDMMYYYY.xlsx.backup
